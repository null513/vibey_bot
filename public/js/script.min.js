function makeid(e){for(var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=n.length,a=0;a<e;a++)t+=n.charAt(Math.floor(Math.random()*r));return t}$(document).ready(function(){$("#sr-table").DataTable({fixedHeader:!0,ordering:!1,paging:!1})}),$("#menu-toggle").click(function(e){e.preventDefault(),$("#wrapper").toggleClass("toggled")});var pusher=new Pusher("94254303a6a5048bf191",{cluster:"us2",forceTLS:!0}),channel=pusher.subscribe("sr-channel");channel.bind("sr-event",function(e){try{console.log("New Request");var t=document.getElementById("srContainer"),n=document.createElement("tr");n.setAttribute("class","song-request"),n.setAttribute("id",`${e.id}`),"spotify"===e.source&&(n.innerHTML=`\n        <td><a class="srLink" target="_blank" href="${e.link}">${e.track} - ${e.artist}</a> <a class="spotify" target="_blank" href="${e.uri}"><i class="fab fa-spotify" title="Open in Spotify"></i></a></td>\n        <td>${e.reqBy}</td>\n        <td>\n          <div class="timeReq" data-time="${e.timeOfReq}"></div>\n        </td>\n        <td>\n          <button class="btn btn-success btn-sm mr-3 p-3 mix-add" data-srID="${e.id}">Mix +</button>\n          <button class="delete btn btn-danger btn-sm" data-srID="${e.id}" data-srName="${e.track} - ${e.artist}"> <i class="fas fa-minus-circle"></i> </button>\n        </td>\n      `),"youtube"===e.source&&(n.innerHTML=`\n        <td><a class="srLink" target="_blank" href="${e.link}">${e.track}</a> <a class="youtube" target="_blank" href="${e.link}"><i class="fab fa-youtube" title="Open on Youtube"></i></a></td>\n        <td>${e.reqBy}</td>\n        <td>\n          <div class="timeReq" data-time="${e.timeOfReq}"></div>\n        </td>\n        <td> \n          <button class="btn btn-success btn-sm mr-3 p-3 mix-add" data-srID="${e.id}">Mix +</button> \n          <button class="delete btn btn-danger btn-sm mix" data-srID="${e.id}" data-srName="${e.track}"> <i class="fas fa-minus-circle"></i> </button> </td>\n      `),t.prepend(n)}catch(e){console.error(e)}});var timeDiff=setInterval(reqTime,1e3);function reqTime(){$(".timeReq").each(function(){var e=moment.utc(`${$(this).attr("data-time")}`).fromNow();$(this).text(`${e}`)})}channel.bind("mix-event",function(e){try{console.log("Song added to mix");var t=document.getElementById("mixContainer"),n=document.createElement("tr");n.setAttribute("class","song-request"),n.setAttribute("id",`${e.id}`),"spotify"===e.source&&(n.innerHTML=`\n        <td><a class="srLink" target="_blank" href="${e.link}">${e.track} - ${e.artist}</a> <a class="spotify" href="${e.uri}"><i class="fab fa-spotify" title="Open in Spotify"></i></a></td>\n        <td>${e.reqBy}</td>\n        <td> \n          <button class="delete btn btn-danger btn-sm mix" data-srID="${e.id}" data-srName="${e.track} - ${e.artist}"> Remove </button>\n        </td>\n      `),e.source,n.innerHTML=`\n        <td><a class="srLink" target="_blank" href="${e.link}">${e.track}</a> <a class="youtube" href="${e.link}"><i class="fab fa-youtube" title="Open on Youtube"></i></a></td>\n        <td>${e.reqBy}</td>\n        <td> \n          <button class="delete btn btn-danger btn-sm mix" data-srID="${e.id}" data-srName="${e.track}"> Remove </button>\n        </td>\n      `,t.prepend(n)}catch(e){console.error(e)}}),$(function(){$("#srContainer").each(function(e,t){var n=$.makeArray($("tr",this).detach());n.reverse(),$(this).append(n)})});const Toast=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3});$("#srContainer").on("click",".mix-add.btn",function(){var e=$(this).attr("data-srID"),t=new XMLHttpRequest;t.open("GET",`/mix/add/${e}`),t.onload=function(){if(200===t.status)try{Toast.fire({type:"success",title:"Song Added to Mix!"})}catch(e){console.error(e)}else Toast.fire({type:"error",title:"Error adding song!",text:"${xhr.responseText}"})},t.send()}),$("#mixContainer").on("click",".mix.delete",function(){var e=$(this).attr("data-srID"),t=new XMLHttpRequest;t.open("GET",`/mix/remove/${e}`),t.onload=function(){if(200===t.status)try{Toast.fire({type:"success",title:"Song Removed from mix!"})}catch(e){console.error(e)}else Toast.fire({type:"error",title:"Error removing song from mix!",text:"${xhr.responseText}"})},t.send()}),channel.bind("mix-remove",function(e){document.getElementById(`${e.id}`).remove()}),$("#clear-queue").on("click",".delete-queue",function(){swal.fire({title:"Are you sure you want to clear the queue?",text:"You won't be able to revert this!",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it!"}).then(e=>{if(e.value){var t=new XMLHttpRequest;t.open("GET","/requests/deleteall"),t.onload=function(){200===t.status?Swal.fire({title:"Cleared!",text:"Queue has been cleared.",type:"success",timer:500,allowOutsideClick:!1,allowEscapeKey:!1,onBeforeOpen:()=>{Swal.showLoading()},onClose:()=>{$("#sr-table tbody tr").remove()}}):Swal.fire("Uh Oh!",`There was an error clearing the queue. Error: ${t.responseText}`,"error")},t.send()}})}),$("#clear-mix").on("click",".delete-mix",function(){swal.fire({title:"Are you sure you want to clear the mix?",text:"You won't be able to revert this!",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it!"}).then(e=>{if(e.value){var t=new XMLHttpRequest;t.open("GET","/requests/mix/deleteall"),t.onload=function(){200===t.status?Swal.fire({title:"Cleared!",text:"Mix has been cleared.",type:"success",timer:500,allowOutsideClick:!1,allowEscapeKey:!1,onBeforeOpen:()=>{Swal.showLoading()},onClose:()=>{$("#mix-table tbody tr").remove()}}):Swal.fire("Uh Oh!",`There was an error clearing the mix. Error: ${t.responseText}`,"error")},t.send()}})}),$("#srContainer").on("click",".delete.btn",function(){var e=$(this).attr("data-srName"),t=$(this).attr("data-srID");swal.fire({title:`Are you sure you want to delete ${e}?`,text:"You won't be able to revert this!",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it!"}).then(n=>{if(n.value){var r=new XMLHttpRequest;r.open("GET",`/requests/delete/${t}`),r.onload=function(){200===r.status?Swal.fire({title:"Deleted!",text:`${e} has been deleted.`,type:"success",timer:500,allowOutsideClick:!1,allowEscapeKey:!1,onBeforeOpen:()=>{Swal.showLoading()},onClose:()=>{try{TweenMax.to(`#${t}`,.5,{autoAlpha:0,margin:0,onComplete:function(){$(`#${t}`).remove()}})}catch(e){console.error(e)}}}):Swal.fire("Uh Oh!",`There was an error deleteing the song request. Error: ${r.responseText}`,"error")},r.send()}})});